# 套用设计模式

- 文档模型： 无范式，无思维定式，充分发挥想象力
- 设计模式： 实战过屡试不爽的设计技巧，快速应用
  举例：
  一个 IoT 场景的分桶设计模式，可以帮助把存储空间降低 10 倍并且查询效率提升数十倍。

```lua

经验和学习   - - 模式导向 - - >     套用设计模式 - - - - - >      最终模式
```

## 问题：物联网场景下的海量数据处理 - 飞机监控数据

```json
{
  "_id": "201609090888800:CA2790",
  "icao": "CA2790",
  "callsign": "CA2790",
  "ts": ISODate("2016-01-10T05:00:00.000+0000"),
  "events": {
    "a": 31418,
    "b": 173,
    "p": [115, -134],
    "s": 91,
    "v": 80
  }
}
```

1. 520 亿条，10TB - 海量数据

- 10 万架飞机
- 1 年的数据
- 每分钟一条

```lua
                         每分钟1条[文档]                                         每小时一个文档
文档条数                   52.6B = 100_000 x 365 x 24 x 60                         876M
索引大小                   6364GB = 100_000 x 365 x 24 x 60 x 130                  106GB
  _id index               1468GB                                                   24.5GB
  {ts:1,deviceId:1}       4895GB                                                  81.6GB

文档平均大小                92 Bytes                                                758 Bytes
数据大小                   4503GB = 100_000 x 365 x 24 x 60 x 92                    618GB
```

### 解决方案： 分桶设计

- 一个文档：一架飞机，一个小时的数据

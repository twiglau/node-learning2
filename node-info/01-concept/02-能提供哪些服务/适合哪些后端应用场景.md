# 介绍 Node.js 特性，且适合哪些后端应用场景

需要寻找网络 I/O 较多，但 CPU 计算较少，业务复杂度高的服务。
可分析出 Node.js 应用在业务网关，中台服务，及运营系统几个方面。

## 服务分类： RESTful 和 RPC, 架构设计规范

```lua
                          - 前端 -
数据缓存                   - 网关 -
                         - 业务网关 -

              -运营系统-   -业务系统-    -中台服务-

数据存储      ---------- 各类基础层 ------------
```

- 网关： 处理请求转发和一些通用的逻辑，例如常见的 Nginx
- 业务网关： 处理业务相关的逻辑，比如一些通用的协议转化，通用的鉴权处理及其他统一的业务安全处理等。
- 运营系统： 负责日常的运营活动或运营系统
- 中台服务： 负责一些通用 App 类的服务，比如配置下发，消息系统及用户返回系统等。
- 各类基础层： 较单一的核心后台服务，例如用户模块，需根据不同业务设计不同的核心底层服务。
- 数据缓存，数据存储： 是响应的数据类的服务。

## 分别从系统的业务场景，及系统特性，来分析为什么 Node.js 更合适

1. 业务网关。

- 后台管理系统有鉴权模块，以往是在管理后台服务中，增加一个鉴权的类，然后在统一路由处增加鉴权
  判断，现在不仅是管理系统需要使用这个鉴权类，多个管理系统都需要这个鉴权类，这时你会考虑这个
  类到其他项目，又或设计一个专门的服务来做鉴权。

```lua

| 缓存服务 |               appid-token api
                                |
          |    <-              鉴权
                                |
          |    <-              接口权限
                                |
          |    <-              频次控制
|  redis  |
```

- 3 个功能都是基于缓存来处理业务逻辑的，大部分是网络 I/O,未涉及 CPU 密集型逻辑 - 这是 Node.js 的优势。

2. 服务特性。

- Node.js 的代码核心是不阻塞主线程处理，而这类业务网关是轻 CPU 运算服务，在这类场景技术选型中，可以考虑使用
  Node.js 作为服务端语言

3. 中台服务
   > 在 Web 或 App 应用中都存在一些 通用服务， 以往都是独立接口，独立开发。

- 随着公司应用越来越多，需要将一些通用的业务服务进行集中。这也是中台的概念。
  而这部分业务场景往往也是网络 I/O 高并发较大，业务关联性高，数据库读写压力相对较小。

- 业务场景

```lua
                     前端Web/App/小程序
                           |
  |               |             |            |
前端配置系统   反馈系统      推送系统       系统工具
```

> 前端配置系统： 在服务端根据客户端的版本，设备，地区和语言下发 不同的配置。
> 反馈系统： 用户可在任何平台调用反馈接口并将反馈内容写入队列，并落地到系统中，进行综合分析。
> 推送系统： 用于管理消息推送用户红点和消息数的拉取，及消息列表的管理。
> 系统工具： 用于处理用户端日志捞取， 用户端信息调试上报，性能定位问题 分析提取。

- 在中台系统的设计中，系统着重关注： 网络 I/O,并发通用性及业务复杂度， 一般情况下不涉及复杂的
  CPU 运算。
- 中台服务，要求： 1. 通用性必须好， 2. 低 CPU 计算， 3. 网络 I/O 高或低都行 4. 并发高或低都行

4. 运营系统

在各类互联网项目中， 经常用运营活动来做项目推广。
这类运营系统往往逻辑复杂，需要根据业务场景进行多次迭代，不断优化，这些活动并发很高，可以不涉及底层
数据库读写，更多的是缓存数据处理。比如：常见的一些投票活动，排行榜活动等。

## 一些密集型 CPU 运算的服务，则非常不适合使用 Node.js 来处理

大内存和 CPU 密集，这样场景都不适合使用 Node.js 来提供服务

- 图片处理：
  > 比如图片的裁剪，图片的缩放。这些非常损耗 CPU 计算，应该用其他进程来处理。
- 大字符串，大数组类处理：
  > 当涉及这些数据时，应考虑如何通过切割来处理或在其他进程异步处理。
- 大文件读写处理：
  > 有时会使用 Node.js 服务来处理 Excel, 但遇到 Excel 过大时，会导致 Node.js 内存溢出，因为 V8
  > 内存上限是 1.4G.

# 环境配置

## env 配置

```sh
# 添加config模块
nest g mo common/config --no-spec

pnpm i @nestjs/config Joi --save
```

## 日志配置

```sh
# 添加logs模块
nest g mo common/logs --no-spec

# 安装第三方库
pnpm i winston nest-winston winston-daily-rotate-file --save
```

## 全局过滤器 - 统一错误处理

```sh
# --flat: 表示最后面的不是文件夹
# --no-spec: 不用创建测试文件
nest g f common/filters/all-exception --flat --no-spec

# ip显示
pnpm i request-ip --save
```

## 配置 cors, version

## swc 编译器 配置

```sh
pnpm i --save-dev @swc/cli @swc/core
```

- 命令后面添加 -b swc

```json
"scripts": {
    // 在打包时，加上swc 类型检查，开发时，不需要
    "build:types": "nest build --type-check",
    "start:dev": "cross-env NODE_ENV=development nest start --watch -b swc"
}
```

- nest-cli.json 中

```json
"compilerOptions": {
    "builder":"swc"
}
```

- swc 与 jest

1. 安装库

```sh
pnpm i @swc/jest --save-dev
```

2. 修改package.json

```json
"transform": {
      "^.+\\.(t|j)s$": ["@swc/jest"]
}
```

## 开启路径别名 tsconfig.json

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["src/*"],
      "src/*": ["src/*"]
    }
  }
}
```

## redis

1. redis 安装 - 镜像

```sh
# 拉取，安装，运行
docker compose -f docker-compose.redis.yaml up -d
# 查看状态
docker ps | grep redis

# 删除镜像
docker compose -f docker-compose.redis.yaml down
```

2. 工具库安装

```sh
pnpm i @nestjs-modules/ioredis ioredis --save
```

3. 创建模块

```sh
nest -g mo common/cache --no-spec
```

## cache-manager

1. 安装库

```sh
pnpm i @nestjs/cache-manager cache-manager keyv @keyv/redis --save
```

## 邮件服务

1. 安装库

```sh
pnpm i --save @nestjs-modules/mailer nodemailer handlebars
```

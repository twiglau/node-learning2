# 守卫

- 守卫是一个使用 @Injectable() 装饰器的类。守卫应该实现 CanActivate 接口。

1. 守卫有一个单独的责任。它们根据运行时出现的某些条件(例如权限，角色，访问控制列表等) 来确定给定的请求
   是否路由处理程序处理。 这通常称为授权。在传统的 Express 应用程序中。 通常由中间件处理授权（以及认证)。
   中间件事身份验证的良好选择，因为诸如 token 验证或添加属性到 request 对象上与特定路由（及其元数据)没有
   强关联。

2. 中间件不知道调用 next() 函数后会执行哪个处理程序。另一方面，守卫可以访问 ExecutionContext 实例，因此
   确切地知道接下来要执行什么。它们的设计与异常过滤器，管道和拦截器非常相似，目的是让您在请求、响应周期的
   正确位置插入处理逻辑，并以声明的方式进行插入。

- 守卫在每个中间件之后执行，但在任何拦截器或管道之前执行。

```sh
nest g gu guards/admin -d
```

## 用户注册逻辑

```lua
 Pipe                              Service                                   Repository
- - - - - -                   - - - - - - -  - -                       - - - - - - - - - - - -
 判断用户，                       查询用户是否存在                             写入数据库
 密码长度       - - - - - - >       加密用户密码       - - - - - - - >
 是否有传递                    - - - - - - - - - -
                                 返回签名脱敏信息
                                    返回 token
```

```lua
                          HASH化
                       使用加密算法
                         进行加密
password  - - > | 输入 - - - - - - -  输出 | - - - >  a69dfakdf69adfad
                            库：
                           crypto,
                           argon2,
                           bcrypt

                            算法：
                            ase,
                            md5
```

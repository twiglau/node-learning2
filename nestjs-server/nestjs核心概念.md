# nestjs 架构： 控制器，服务，数据访问

## Nestjs核心概念

```lua
          请求              使用服务              数据库
客户端 <- - - - > 控制器 <- -  - - - - > 服务 <- - - - - - - > 数据接入
          响应              依赖注入              持久化
```

- Controller 层负责处理请求，返回响应；
- Service 层负责提供方法和操作，只包含业务逻辑；
- Data Access 层负责访问数据库中的数据；

## Nestjs 生命周期

- 钩子方法： 定一个空的函数，用户可以自定义该方法来改变原有的逻辑

```lua
客户端   - - - > 中间件 - - - > 守卫 - - - - > 拦截器 - - - - > 管道
 |                                                             |
响应 < - - - - - - 过滤器 < - - 拦截器 <- - -  服务 <- - - -   控制器
```

- 中间件： 全局中间件，模块中间件
- 守卫：全局守卫，控制器守卫，路由守卫
- 拦截器： 全局拦截器 pre, 控制器拦截器 pre, 路由拦截器 pre
- 管道： 全局管道，控制器管道，路由管道，路由参数管道
- 拦截器： 路由拦截器post, 控制器拦截器post, 全局拦截器post
- 过滤器： 路由过滤器，控制器过滤器，全局过滤器

## Nestjs 用模块来组织代码

```lua
                Application Module

Users Module         Orders Module             Chat Module

              Feature Module 1 | Module 2    Feature Module 3
```

- 使用 Module 来组织应用程序
- @Module装饰器来描述模块
- 模块中有4大属性：imports, providers, controllers, exports

```lua
功能模块  - 功能模块与共享模块是一回事，只是叫法不一样
共享模块
全局模块  - 全局模块通常应用在配置，数据库连接，日志上
动态模块  - 动态模块是在使用到模块的时候才初始化
```

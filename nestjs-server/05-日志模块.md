# 日志模块

- 作用：记录错误并定位问题

## 日志需要怎么定位问题？

- 什么时间发生的？
- 发生了什么事情？
- 错误是什么？

## 重点

- 常见日志及获取（记录）方式
- 第三方日志方案：winston(勤快的人), pino(推荐懒人)
- 通用业务系统日志系统配置（学习定时任务）

## 日志等级

- Log: 通用日志，按需进行记录（打印）
- Warning: 警告日志，比如：尝试多次进行数据库操作；
- Error: 严重日志，比如：数据库异常
- Debug: 调试日志，比如：加载数据日志
- Verbose: 详细日志，所有的操作与详细信息（非必要，不打印）

## 功能分类日志

- 错误日志： 方便定位问题，给用户友好的提示
- 调试日志： 方便开发
- 请求日志： 记录敏感行为

## 日志记录位置

- 控制台日志：方便查看（调试用）
- 文件日志：方便回溯与追踪（24 小时滚动）
- 数据库日志：敏感操作，敏感数据记录

## Nestjs 内置日志模块 Logger

## 第三方日志模块 Pino

```sh
pnpm i --save nestjs-pino pino-pretty pino-roll
```

- pino-pretty: 日志格式化
- pino-roll: 用户生产环境（滚动日志）

## 第三方日志模块 winston

```sh
pnpm i --save nest-winston winston
```

- `winston-daily-rotate-file` 滚动日志
- 全局异常过滤器配合 winston 记录日志
